<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Notes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        .mybooks-container {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 20px;
            justify-content: center;
            align-items: center;
            margin:20px 0px 30px 0 ;
            padding-bottom: 40px;
        }

        .mybooks-container .mybook-card {
            width: 80%;
            margin: 30px 0;
            display: flex;
            flex-direction: row;
            gap: 10%;
        }

        .notes-container {
            margin-top: 10px;
            height: 100%;
            width: 78%;
            position: relative;
            border: none;
        }

        .btn-danger {
            background-color: #dc3545;
            color: white;
            border-color: #dc3545;
        }

        .btn-danger:hover {
            background-color: #c82333;
            border-color: #bd2130;
        }

        .notes-container textarea {
            width: 100%;
            height: 350px;
            resize: none;
            border-radius: 5px;
            padding: 8px 5px;
            border: 1px solid #ccc;
            background-color: #f5f7f8;
            /* Darker color */
            color: #333;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            /* Add shadow */
            padding: 10px;
        }

        .notes-container textarea ::placeholder {
            padding-left: 5px;
            color: #999191;
        }

        .notes-container textarea[readonly] {
            background-color: #afa88f;
            box-shadow: none;
            border: unset;
            color: white;
            /* Darker color for readonly */
        }

        .readonly-caret {
            caret-color: transparent;
        }

        .image-container {
            position: relative;
            float: left;
            width: 25%;
            height: auto;
            overflow: hidden;
        }

        .image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s, filter 0.3s;
        }

        .image-container:hover img {
            filter: brightness(50%);
        }

        .image-info {
            position: absolute;
            top: 0;
            left: 0;
            padding: 10px 5px;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.6s;
            text-align: center;
        }

        .image-container:hover .image-info {
            opacity: 1;
        }

        .rating {
            margin-top: 10px;
            font-size: 24px;
            cursor: pointer;
            }

        .star {
            cursor: pointer;
            color: #ccc;
            transition: color 0.3s;
        }

        .star.active {
            color: #ffcc00;
        }

        .notes-container .btn-edit {
            background-color: #ffc107;
            /* Yellow color */
            color: black;
            border-color: #ffc107;
        }

        .notes-container .btn-edit:hover {
            background-color: #e0a800;
            /* Darker yellow color */
            border-color: #d39e00;
        }

        .delete {
            position: relative;
            margin-top:-90px;
            margin-left: -90px;
            margin-bottom: auto;
        }
    </style>
</head>

<body>
    <%- include("partials/topnav.ejs") %>
        <div class="mybooks-container ">
            <% myBooks.forEach((book,index)=> {%>
                <form class="mybook-card" action="/savemybooks" method="post">
                    <input name="coverId" value=" <%= book.coverid %>" type="hidden">
                    <div class="image-container"><img src="https://covers.openlibrary.org/b/id/<%= book.coverid%>-L.jpg"
                            loading="lazy" alt=""></img>
                        <div class="image-info">
                            <h5>
                                <%= book.title %>
                            </h5>
                            <p><strong>Author: </strong>
                                <%= book.author %> <br>
                                    <strong>Publish Year: </strong>
                                    <%= book.publishyear %> <br>
                            </p>
                            <div class="rating">
                                <% if(book.rate){ %>
                                    <% for(let i=1; i<=5; i++) { %>
                                        <% if(i <=book.rate) { %>
                                            <button type="submit" name="rate" value="<%= i %>" class="btn"><span
                                                    class="star active">&#9733;</span></button>
                                            <% } else { %>
                                                <button type="submit" name="rate" value="<%= i %>" class="btn"><span
                                                        class="star">&#9733;</span></button>

                                                <% } %>
                                                    <% }} else{ %> <button type="submit" name="rate" value="1"
                                                            class="btn"><span class="star">&#9733;</span></button>
                                                        <button type="submit" name="rate" value="2" class="btn"><span
                                                                class="star">&#9733;</span></button>
                                                        <button type="submit" name="rate" value="3" class="btn"><span
                                                                class="star">&#9733;</span></button>
                                                        <button type="submit" name="rate" value="4" class="btn"><span
                                                                class="star">&#9733;</span></button>
                                                        <button type="submit" name="rate" value="5" class="btn"><span
                                                                class="star">&#9733;</span></button>
                                                        <% } %>
                            </div>
                        </div>
                    </div>
                    <div class="notes-container">
                        <textarea class="book-notes" name="newNotes" placeholder="Add your Notes here boo"
                            readonly> <%= book.notes %></textarea>
                        <button class="btn btn-edit ">Edit Notes</button>

                    </div>
                </form>
                <form class="delete" action="/delete" method="post">
                    <input name="coverId" value=" <%= book.coverid %>" type="hidden">
                    <button id="deleteButton" class="btn btn-danger" type="submit">Delete</button>
                </form>
                <% }); %>

        </div>
</body>
<script>


    function selectRating(index, rating) {
        const ratingInput = document.getElementById('ratingInput' + index);
        ratingInput.value = rating;
        // Update the visual rating
        const stars = document.getElementById('ratingStars' + index).querySelectorAll('.star');
        stars.forEach(function (star, i) {
            if (i < rating) {
                star.classList.add('active');
            } else {
                star.classList.remove('active');
            }
        });
    }

    document.addEventListener('DOMContentLoaded', function () {
        const ratings = document.querySelectorAll('.rating');
        ratings.forEach(function (rating, index) {
            const savedRating = parseInt(rating.getAttribute('data-rating')) || 0;
            selectRating(index, savedRating);
        });
    });


    const notesTextarea = document.querySelectorAll('.book-notes');
    const editButton = document.querySelectorAll('.btn-edit');

    for (let i = 0; i < notesTextarea.length; i++) {

        editButton[i].addEventListener('click', () => {
            if (notesTextarea[i].readOnly) {
                notesTextarea[i].readOnly = false;
                editButton[i].textContent = 'Save Notes';
                notesTextarea[i].classList.remove('readonly-caret');
                editButton[i].type = 'button'; // Change button type to submit
            } else {
                notesTextarea[i].readOnly = true;
                editButton[i].textContent = 'Edit Notes';
                notesTextarea[i].classList.add('readonly-caret');
                editButton[i].type = 'submit'; // Change button type to button
            }
        });

        // Initial setup for the textarea
        notesTextarea[i].classList.add('readonly-caret');

    } 
</script>

</html>